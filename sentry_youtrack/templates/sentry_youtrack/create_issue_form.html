{% extends "sentry/groups/details.html" %}

{% load i18n crispy_forms_filters %}

{% block title %}{{ title }} | {{ block.super }}{% endblock %}

{% block inner %}
<div class="span12">
    <div class="page-header">
        <h3>{{ title }}</h3>
    </div>

    {% if form.non_field_errors %}
    <div class="alert alert-block alert-error">
        <ul>
            {% for error in form.non_field_errors %}
            <li>{{ error }}</li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}


    <form id='create-issue' class="form-horizontal" action="" method="post">
        {% csrf_token %}
        <input type="hidden" name="next" value="{{ next }}" />
        <div class="form-fields">
            {{ form|crispy }}
            <p class="actions">
                {% block submit_button %}
                    <button type="submit" class="btn btn-primary">{% trans "Create issue" %}</button>
                {% endblock %}
            </p>
        </div>
    </form>
</div>
{% endblock %}

{% block scripts %}
    {{ block.super }}

    {% block yt_issue_js %}
        <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/spin.js/1.3.2/spin.min.js"></script>
        <script type="text/javascript">
            var spinner = new Spinner().spin();

            function load_issue_form() {
                $.ajax({
                    'url': "?form=1",
                    beforeSend: function( xhr ) {
                        $(".form-fields").html(spinner.el);
                        $(".spinner").css('left', '50%');
                    }
                }).done(function(data){
                    var form = $("#create-issue .form-fields", data);
                    $(".form-fields").html(form);
                });
            }
        </script>

        {% if not request.POST %}
            <script>
                $(function(){
                    load_issue_form();
                });
            </script>
        {% endif %}
    {% endblock %}
{% endblock %}
